<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãŠé¢¨å‘‚ æ··é›‘äºˆæ¸¬ï¼†äºˆç´„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#f2f6f8;
  margin:0;
  padding:12px;
}
.container{
  max-width:420px;
  margin:auto;
  background:#fff;
  border-radius:16px;
  padding:16px;
}
h1{text-align:center;font-size:1.3rem;}
.time{text-align:center;color:#555;margin-bottom:8px;}
.status{
  text-align:center;
  padding:18px;
  border-radius:12px;
  font-size:1.2rem;
  font-weight:bold;
  margin-bottom:14px;
}
.empty{backğŸ”´ğŸ”´ç”¨æ™‚é–“å¤–";
    s.classList.add("crowded");
  }else{
    s.textContent="ğŸ”´åˆ©ç”¨å¯èƒ½";
    s.classList.add("empty");
  }
}

/* ===== äºˆç´„å‡¦ç† ===== */
function loadReservations(){return JSON.parse(localStorage.getItem("bathReservations"))||{};}
function saveReservations(d){localStorage.setItem("bathReservations",JSON.stringify(d));}

let reservationChart;

function reserve(){
  const t=reserveTime.value;
  const now=new Date();
  const nowMin=now.getHours()*60+now.getMinutes();
  const [h,m]=t.split(":").map(Number);
  const sel=h*60+m;

  if(sel<start||sel>end||sel<nowMin){
    show("ã“ã®æ™‚é–“ã¯äºˆç´„ã§ãã¾ã›ã‚“","error");return;
  }

  const r=loadReservations();
  if((r[t]||0)>=maxCapacity){
    show("æº€å“¡ã§ã™","error");return;
  }

  r[t]=(r[t]||0)+1;
  saveReservations(r);
  show(`${t} ã«äºˆç´„ã—ã¾ã—ãŸ`);
  drawReservationChart();
}

function resetReservations(){
  const t=reserveTime.value;
  const r=loadReservations();
  if(!r[t]){show("äºˆç´„ãªã—","error");return;}
  r[t]--; if(r[t]<=0) delete r[t];
  saveReservations(r);
  show("1äººå‰Šé™¤ã—ã¾ã—ãŸ");
  drawReservationChart();
}

/* ===== äºˆç´„ã‚°ãƒ©ãƒ•ï¼ˆç¸¦å‘ãï¼‰ ===== */
function drawReservationChart(){
  const data=timeLabels.map(t=>loadReservations()[t]||0);
  if(reservationChart) reservationChart.destroy();
  reservationChart=new Chart(document.getElementById("reservationChart"),{
    type:"bar",
    data:{
      labels:timeLabels,
      datasets:[{
        data,
        backgroundColor:data.map(v=>v>=maxCapacity?"#f44336":"#ff9800")
      }]
    },
    datasets: [{
      data,
      barThickness: 14,        // â† ãƒãƒ¼è‡ªä½“ã®å¤ªã•
      categoryPercentage: 0.7, // â† è¡Œå…¨ä½“ã«å¯¾ã™ã‚‹ä½¿ç”¨ç‡
      barPercentage: 0.6       // â† ãƒãƒ¼ã®å æœ‰ç‡
    }],

    options:{
      indexAxis:"y",          // â† ã“ã“ãŒç¸¦å‘ã
      responsive:true,
      maintainAspectRatio:false,
      scales:{
        x:{min:0,max:maxCapacity},
        y:{ticks:{autoSkip:false}}
      },
      plugins:{legend:{display:false}}
    }
  });
}

function show(m,t="success"){
  const e=document.getElementById("reserveResult");
  e.textContent=m;
  e.className=t==="success"?"msg-success":"msg-error";
}

/* ===== åˆæœŸåŒ– ===== */
const today=new Date().getDay();
daySel.value=today;
drawCrowdChart(today);
drawReservationChart();
updateTime();
predictCrowd();

setInterval(()=>{
  updateTime();
  predictCrowd();
},10000);
</script>
</body>
</html>

